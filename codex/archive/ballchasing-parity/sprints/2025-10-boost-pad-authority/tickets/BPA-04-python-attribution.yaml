title: "[rlcoach] Preserve pad metadata through normalization and analyzer attribution"
type: feature
priority: P0
branch: "feature/bpa-04-python-attribution"
repo:
  url: https://github.com/treygoff/rlcoach
  root: .
  paths_in_scope:
    - src/rlcoach/normalize.py
    - src/rlcoach/events.py
    - src/rlcoach/parser/types.py
    - src/rlcoach/parser/rust_adapter.py
    - tests/test_events.py
  paths_out_of_scope:
    - parsers/rlreplay_rust/**
context:
  stack: {lang: Python, framework: pytest, runtime: Python 3.10}
  versions: {pytest: "7.x"}
  style_guides: ["codex/docs/gpt5-codex-ticketing-guide.md", "codex/docs/gpt5-prompting-best-practices-guide.md"]
  related_issues:
    - "codex/Plans/1015_boost_pickup_rewrite_followup_plan.md"
    - "codex/sprints/2025-10-boost-pad-authority/tickets/BPA-03-rust-pad-registry.yaml"
problem_statement: >
  Even after the Rust registry emits authoritative events, normalization currently discards metadata when `player_id`
  is missing and analyzers fall back to heuristic boost deltas. Preserve the rich pad metadata, add actor-based
  attribution, and surface quality warnings when resolution fails.
non_goals:
  - Do not modify boost economy summary tables outside of pickup attribution logic.
  - Do not change kickoff or challenge analyzers.
constraints:
  - Maintain backward compatibility when Rust events are absent (legacy adapter paths).
  - Provide structured warnings that propagate into report metadata when attribution degrades.
  - Keep analyzer runtime O(number_of_frames); avoid additional replay passes.
artifacts_expected:
  output_mode: diff
  pr_title_template: "[analysis] Preserve pad metadata for boost attribution"
  pr_body_sections: ["Context", "Implementation", "Tests", "Risks", "Follow-ups"]
  decision_log: true
acceptance_criteria:
  - [ ] Extend `BoostPadEventFrame` to store `snap_distance`, `tolerance`, `status_detail`, `instigator_actor_id`, and `actor_id`.
  - [ ] Normalize Rust frames without dropping events lacking `player_id`; maintain an actor-to-player lookup for attribution.
  - [ ] Update `_detect_boost_pickups_from_pad_events` to resolve players via actors before falling back to legacy heuristics, emitting explicit quality warnings when unresolved.
  - [ ] Add unit tests covering attribution success, unresolved warnings, and fallback to legacy detection.
  - [ ] Ensure `detect_boost_pickups` prefers Rust events when present and never double-counts combined with legacy heuristics.
verification:
  repro_steps: |
    pytest tests/test_events.py::TestBoostPickupDetection -q
  checks:
    - cmd: "pytest tests/test_events.py -q"
    - cmd: "pytest tests/test_report_end_to_end.py -q"
workflow_expectations:
  - plan-first
  - implement
  - self-check
  - emit_patch
  - run_verification
  - summarize
codex:
  approvals: all
  sandbox: workspace-write
  web_search: false
  progress: brief
  review:
    ask_for_diff_format: unified
  agents_md: true
